---
layout:     post
title:     Maven 常用命令
date:       2020-02-23
author:     jiulongzhu
header-img: img/moon_night.jpg
catalog: true
tags:
    - tools
---
　　
 
<!-- more --> 

## 基础选项 
  
  -v，--version     显示 maven 版本   
  -X，-debug       显示 debug 日志    
  -e，--error        显示 error 日志    
  -q,  --quite         仅仅显示 error 日志信息    
  -o，--offline      离线构建   
  -N，--non-recursive   仅构建当前模块，不递归到子模块  
  -pl，--projects     仅在指定模块构建，避免构建所有模块，多模块用逗号分隔。e.g. -pl core,sql/core      
  -am，--also-make   构建指定模块时，且构建指定模块依赖的所有模块  
  -amd，--also-make-dependents  构建指定模块时，且构建依赖该指定模块的所有模块  
  -D，--define     定义构建属性  e.g.  -Dhadoop.version=2.7.3，-DskipTests  
  -P，--activate-profiles    激活pom 文件中指定 id的 profile，多个则逗号分隔。 e.g. -Pyarn,hive-1.2 
  -T, --threads    并行构建，支持数字或 NC(N*core)个线程。e.g. -T  2C 每个 core 2 个线程  
  -h, --help  显示帮助信息  
  
```
关于-am 和-amd  

假设 core 模块依赖 common 模块，sql 模块依赖 core 模块。使用--am 构建 core 模块时，会额外构建 common 模块；使用--am 构建 sql 模块时，会额外构建 common 和 core 模块；使用--amd 构建 core 模块时，会额外构建 sql 模块
```

## JVM

Maven 运行在 JVM 中，可以使用 JVM 的优化选项。JVM 配置较多，不再赘述。  

-Xmx2G -Xms2G -XX:+UseG1GC       JVM 内存和垃圾回收器配置  
-XX:+TieredCompilation -XX:TieredStopAtLevel=1     JVM只进行基础的即时编译操作   

## 常用生命周期  

clean：删除工程的 target 目录，但是不会删除打包到本地仓库和远程仓库的 jar/war 文件    
compile：编译配置的源代码目录到 target 的 class 目录(具体情况可能不同, e.g. scala-2.11,scala-2.12)          
package：将 target 目录下编译过的代码文件打包成可发布的形式放到工程 target 目录下     
install：将 package 打包的 jar/war 文件安装到本地仓库，可供本地其他工程使用    
deploy：将jar/war 包发布到远程仓库(e.g. 私服)  
test：使用单元测试框架运行测试       
其他: validate、initialize、site... 

```
Maven 生命周期的各个阶段是前后依赖的，进行构建时 只有该阶段及其之前的阶段会被调用。调用 mvn deploy 时，以前阶段依次执行(不包含 clean)    

validate              验证工程是否正确,且文件信息完整可以完成工程构建     
initialize             初始化构建状态，如设置 properties、创建目录等  
generate-sources     生成包含在编译阶段的任何源代码
process-sources  	     处理源代码  
generate-resources      生成将包含在工程中的资源文件  
process-resources      处理工程资源文件: 变量替换、复制到 target/classes 目录
compile                编译工程源代码(一般在 src/main目录)到 target/classes
process-classes        处理编译生成的文件，如对 class 文件做字节码优化  
generate-test-sources   生成包含在编译阶段的任何测试源代码  
process-test-sources     处理测试源代码 
generate-test-resources   生成将包含在工程的测试资源文件
process-test-resources     处理工程测试资源文件: 变量替换、复制到 target/test-classes 目录
test-compile         编译工程测试源代码(一般在 src/test 目录)到 target/test-classes 
process-test-classes     处理测试编译生成的文件，如对 class 文件做字节码优化  
test                 使用单元测试框架运行测试   
prepare-package    为打包做准备  
package              使用已编译好的 classes 和 test-classes，打包成可发布的形式放到工程 target 目录下
pre-integration-test   集成测试前的准备工作，如搭建集成测试环境
integration-test       集成测试  
post-integration-test   集成测试后的工作，如清理集成测试环境  
verify          检查工程可发布包有效且达到质量标准  
install           将 target 目录下的可发布包安装到本地仓库，使其可被本地其他工程使用  
deploy      将本地仓库下的可发布包安装到远程仓库(e.g. mvn repository)，使其可被其他工程、开发人员下载使用  
```

## 常用命令  

MAVEN_OPTS="-Xmx2G -Xms2G -XX:+UseG1GC XX:+TieredCompilation -XX:TieredStopAtLevel=1"  
mvn -T 2C clean install -pl module1,module2 -am -offline > install.log   
  
mvn install:install-file -Dfile=\$file -DgroupId=\$groupId --DartifactId=\$artifactId -Dversion=\$version -Dpackaging=jar   

mvn dependency:tree  

## 参考 

生命周期  https://www.runoob.com/maven/maven-build-life-cycle.html  
TieredCompilation   https://www.jianshu.com/p/318617435789

